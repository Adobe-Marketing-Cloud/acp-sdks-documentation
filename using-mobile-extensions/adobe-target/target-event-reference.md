# Target event reference

## Events handled

### Target Content Request

This event is created when a public API is called to send a Target request for the associated mbox location or to prefetch locations.

This event will be generated by:

* The public API when a new Target request needs to be sent \(`loadRequests`\)
* The public API when a Target prefetch is initiated \(`prefetchContent`\)
* The public API when the Target preview restart deeplink is set \(`setPreviewRestartDeepLink`\)
* The public API when a click notification needs to be sent to Target \(`locationClicked`\)

#### Data Payload Definition

Here are the key-value pairs in this event:

| **Key** | **Value Type** | **Optional** | **Description** |
| :--- | :--- | :--- | :--- |
| restartdeeplink | String | Yes | Populated when `setPreviewRestartDeepLink` API was called |
| profileparams | StringMap | Yes | Populated when the `prefetchContent`/ `loadRequests` API is called. |
| islocationclicked | Boolean | Yes | Populated when `locationClicked` API is invoked. |

The `locationClicked` API parameters are also sent in the event, as described below:

```text
{
    "islocationclicked": <Boolean>
    "mboxname": <String>
    "mboxparameters": <StringMap>
    "productparameters": <StringMap>
    "orderparameters": <VariantMap>
    "profileparameters": <StringMap>
}
```

| Key | Value Type | Optional | Description |
| :--- | :--- | :--- | :--- |
| prefetch | VariantVector | Yes | Populated when `prefetchContent API` is called. |

The `prefetch` key contains a list of objects, each with the following content:

```text
{
    "mboxname": <String>
    "mboxparameters": <VariantMap>
    "productparameters": <VariantMap>
    "orderparameters": <VariantMap>
}
```

| Key | Value Type | Optional | Description |
| :--- | :--- | :--- | :--- |
| request | VariantVector | Yes | Populated when `loadRequests` API is called. |

The `request` key contains a list of target requests, each with the following content:

```text
{{
    "mboxname": <String>
    "mboxparameters": <VariantMap>
    "productparameters": <VariantMap>
    "orderparameters": <VariantMap>
}
"defaultcontent": <String>
"responsepairid": <String>
}
```

### Target Identity Request

This event is a request to retrieve Target identities such as third-party IDs and TNT IDs or to set the third-party ID.

This event will be generated by:

* The public APIs requesting a Target Identity \(`getThirdPartyId`, `getTntId`\).
* The public API setting the third-party ID \(`setThirdPartyId`\).

#### Data Payload Definition

Here are the key-value pairs in this event:

| **Key** | **Value Type** | **Optional** | **Description** |
| :--- | :--- | :--- | :--- |
| thirdpartyid | String | Yes | Populated when the `setThirdPartyId` public API is called. |

### Target Reset Request

This event is created by customers who use the public API to reset the Target parameters.

This event will be generated by:

* The public API from the customers to clear Target parameters \(`resetExperience` API\).
* The public API to clear the prefetch cache \(`clearPrefetchCache` API\).

#### Data Payload Definition

Here are key-value pairs in this event:

| **Key** | **Value Type** | **Optional** | **Description** |
| :--- | :--- | :--- | :--- |
| resetexperience | Boolean | Yes | Present in the event generated by the `resetExperience` public API. |
| clearcache | Boolean | Yes | Present in the event generated by the `clearPrefetchCache` API. |

### Configuration Response Content

The data property in the Configuration Response Content event is used by each extension to modify its current settings. Each extension is responsible to read out the part of the data property for which it is concerned.

The Target extension will read the following keys from the configuration event:

| **Key** | **Value Type** | **Optional** | **Description** |
| :--- | :--- | :--- | :--- |
| target.clientCode | String | No | The Target Client Code obtained during provisioning with Target Adobe solution |
| target.environmentId | String | Yes | The Target Environment ID |
| target.timeout | String | Yes | This value is used for target requests connection timeout \(in seconds\). If not set, a default value of 5 seconds will be used. |
| global.privacy | String | Yes | This contains the mobile privacy status settings |

## Events dispatched

### Target Content Response

This event is created when the Target server response is received and the prefetch or load request operation is completed. Network responses are generated from the Target server for prefetch or load request calls.

This event is dispatched in the following scenarios:

* In response to an API prefetch content request.   This event contains a `prefetchresult` key of type _boolean_, which signals the success or failure of the prefetch request.
* In response to an API batch load requests, where one event is dispatched per request.

  This event contains a `content` key of type _string_ that contains mbox content.

#### Data Payload Definition

Here are the key-value pairs in this event:

| **Key** | **Value Type** | **Optional** | **Description** |
| :--- | :--- | :--- | :--- |
| content | String | Yes | Response content is returned by the Target server for a load request with valid locations. |
| prefetchresult | Boolean | Yes | Prefetch status returned after a Target prefetch request. |

### Target Identity Response

The purpose of this event is to do the following:

* Deliver the Target Identities to the original requester.
* Deliver the Target Identities to any extension that might be listening for updates.

This event will be generated by the Target extension as a response to the Target Identity Request event.

#### Data Payload Definition

Here are the key-value pairs in this event:

| **Key** | **Value Type** | **Optional** | **Description** |
| :--- | :--- | :--- | :--- |
| tntid | String | Yes | The Target Identifier retrieved from Target server |
| thirdpartyid | String | Yes | Current Third Party ID being set from the public API |

## Shared states

**MODULE\_NAME**: `com.adobe.module.target`

Shared state for this module is updated whenever the ID's are set/reset from either public or target servers.

| Key | Type | Description |
| :--- | :--- | :--- |
| tntid | String | This is the primary identifier in Target for an individual user. Also known as PCID or  mboxPCID.  The `tntId` is not returned in the target API response if a `thirdPartyId` or `experienceCloudVisitorId` is provided in the request. |
| thirdpartyid | String | Client-provided visitor ID for Target. |

